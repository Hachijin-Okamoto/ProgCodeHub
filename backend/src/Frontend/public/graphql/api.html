<!doctype html>
<html lang="ja">
  <head>
    <meta charset="UTF-8" />
    <title>ProgCodeHub API (GraphQL)</title>
    <link rel="stylesheet" href="/ui/style.css" />
  </head>
  <body>
    <h1>ProgCodeHub API (GraphQL)</h1>

    <!-- ===================== -->
    <!-- Problems -->
    <!-- ===================== -->
    <section>
      <h2>Problems</h2>

      <button type="button" onclick="getAllProblems()">Query: problems</button>

      <div>
        <input id="problemId" placeholder="problem id" type="number" />
        <button type="button" onclick="getProblemById()">
          Query: problem(id)
        </button>
      </div>
    </section>

    <!-- ===================== -->
    <!-- Submissions -->
    <!-- ===================== -->
    <section>
      <h2>Submissions</h2>

      <button type="button" onclick="getAllSubmissions()">
        Query: submissions
      </button>

      <div>
        <input id="submissionProblemId" placeholder="problemId" type="number" />
        <button type="button" onclick="getSubmissionsByProblem()">
          Query: problem(id).submissions
        </button>
      </div>
    </section>

    <!-- ===================== -->
    <!-- Query / Response -->
    <!-- ===================== -->
    <h2>Query</h2>
    <pre id="query"></pre>

    <h2>Response</h2>
    <pre id="output"></pre>

    <script src="/ui/graphql/main.js"></script>
    <script>
      const queryEl = document.getElementById('query');
      const outputEl = document.getElementById('output');

      function show(query, data) {
        queryEl.textContent = query.trim();
        outputEl.textContent = JSON.stringify(data, null, 2);
      }

      function getAllProblems() {
        const query = `
          query {
            problems {
              id
              title
            }
          }
        `;
        gql(query).then((data) => show(query, data));
      }

      function getProblemById() {
        const id = Number(document.getElementById('problemId').value);
        const query = `
          query ($id: ID!) {
            problem(id: $id) {
              id
              title
              description
            }
          }
        `;
        gql(query, { id }).then((data) => show(query, data));
      }

      function getAllSubmissions() {
        const query = `
          query {
            submissions {
              id
              userName
              problemId
            }
          }
        `;
        gql(query).then((data) => show(query, data));
      }

      function getSubmissionsByProblem() {
        const problemId = Number(
          document.getElementById('submissionProblemId').value,
        );
        const query = `
          query ($id: ID!) {
            problem(id: $id) {
              submissions {
                id
                userName
              }
            }
          }
        `;
        gql(query, { id: problemId }).then((data) => show(query, data));
      }
    </script>
  </body>
</html>
